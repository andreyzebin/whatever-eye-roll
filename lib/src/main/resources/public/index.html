<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avatar Animation Player</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }

        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .avatar-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
        }

        .controls {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .status {
            margin-bottom: 20px;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
        }

        .connected {
            background: rgba(76, 175, 80, 0.3);
            border: 2px solid #4CAF50;
        }

        .disconnected {
            background: rgba(244, 67, 54, 0.3);
            border: 2px solid #F44336;
        }

        .button-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(45deg, #FF6B6B, #FF8E53);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        button:active {
            transform: translateY(0);
        }

        .scenario-buttons {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }

        .scenario-btn {
            background: linear-gradient(45deg, #4ECDC4, #556270);
        }

        .custom-controls {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .slider-container {
            margin: 10px 0;
        }

        .slider-container label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input[type="range"] {
            width: 100%;
            margin: 5px 0;
        }

        h1, h2 {
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        #avatarSvg {
            max-width: 300px;
            max-height: 300px;
            transition: all 0.3s ease;
        }

        #avatarSvg:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
<h1>üé≠ Avatar Animation Player</h1>

<div class="container">
    <div class="avatar-container">
        <div id="avatarDisplay">
            <!-- SVG –±—É–¥–µ—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω –∑–¥–µ—Å—å -->
        </div>
    </div>

    <div class="controls">
        <div id="connectionStatus" class="status disconnected">
            ‚ùå –ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ
        </div>

        <div class="button-grid">
            <button onclick="connect()">üîó –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</button>
            <button onclick="disconnect()">‚ùå –û—Ç–∫–ª—é—á–∏—Ç—å—Å—è</button>
        </div>

        <h2>–ë–∞–∑–æ–≤—ã–µ —ç–º–æ—Ü–∏–∏</h2>
        <div class="button-grid">
            <button onclick="sendCommand('happy')">üòä –°—á–∞—Å—Ç–ª–∏–≤—ã–π</button>
            <button onclick="sendCommand('sad')">üò¢ –ì—Ä—É—Å—Ç–Ω—ã–π</button>
            <button onclick="sendCommand('angry')">üò† –ó–ª–æ–π</button>
            <button onclick="sendCommand('surprised')">üòÆ –£–¥–∏–≤–ª—ë–Ω–Ω—ã–π</button>
        </div>

        <h2>–°—Ü–µ–Ω–∞—Ä–∏–∏ –∞–Ω–∏–º–∞—Ü–∏–∏</h2>
        <div class="scenario-buttons">
            <button class="scenario-btn" onclick="playScenario('greeting')">
                üëã –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
            </button>
            <button class="scenario-btn" onclick="playScenario('thinking')">
                ü§î –†–∞–∑–º—ã—à–ª–µ–Ω–∏–µ
            </button>
            <button class="scenario-btn" onclick="playScenario('laughing')">
                üòÑ –°–º–µ—Ö
            </button>
            <button class="scenario-btn" onclick="playScenario('sleeping')">
                üò¥ –°–æ–Ω
            </button>
        </div>

        <div class="custom-controls">
            <h2>–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h2>
            <div class="slider-container">
                <label for="mouthOpen">–û—Ç–∫—Ä—ã—Ç–∏–µ —Ä—Ç–∞: <span id="mouthOpenValue">0.1</span></label>
                <input type="range" id="mouthOpen" min="0" max="1" step="0.1" value="0.1" oninput="updateCustomValue('mouthOpen')">
            </div>

            <div class="slider-container">
                <label for="mouthCurve">–ò–∑–≥–∏–± —Ä—Ç–∞: <span id="mouthCurveValue">0.0</span></label>
                <input type="range" id="mouthCurve" min="-1" max="1" step="0.1" value="0.0" oninput="updateCustomValue('mouthCurve')">
            </div>

            <div class="slider-container">
                <label for="eyeOpen">–û—Ç–∫—Ä—ã—Ç–∏–µ –≥–ª–∞–∑: <span id="eyeOpenValue">1.0</span></label>
                <input type="range" id="eyeOpen" min="0" max="1.5" step="0.1" value="1.0" oninput="updateCustomValue('eyeOpen')">
            </div>

            <button onclick="sendCustomCommand()">üöÄ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        </div>
    </div>
</div>

<script>
    let ws = null;
    const serverUrl = 'ws://' + window.location.host + '/avatar-stream';

    function connect() {
        if (ws && ws.readyState === WebSocket.OPEN) {
            alert('–£–∂–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ!');
            return;
        }

        try {
            ws = new WebSocket(serverUrl);

            ws.onopen = function() {
                updateStatus('connected', '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É');
                console.log('Connected to WebSocket server');
            };

            ws.onmessage = function(event) {
                // –û–±–Ω–æ–≤–ª—è–µ–º SVG
                document.getElementById('avatarDisplay').innerHTML = event.data;
            };

            ws.onclose = function() {
                updateStatus('disconnected', '‚ùå –û—Ç–∫–ª—é—á–µ–Ω–æ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞');
                console.log('WebSocket connection closed');
            };

            ws.onerror = function(error) {
                updateStatus('disconnected', '‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è');
                console.error('WebSocket error:', error);
                alert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8080.');
            };

        } catch (error) {
            console.error('Connection error:', error);
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏: ' + error.message);
        }
    }

    function disconnect() {
        if (ws) {
            ws.close();
            ws = null;
        }
        updateStatus('disconnected', '‚ùå –ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ');
    }

    function updateStatus(status, message) {
        const statusEl = document.getElementById('connectionStatus');
        statusEl.className = 'status ' + status;
        statusEl.textContent = message;
    }

    function sendCommand(type) {
        if (!ws || ws.readyState !== WebSocket.OPEN) {
            alert('–°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É!');
            return;
        }

        const commands = {
            'happy': {
                state: { eyeOpen: 1.0, eyeRoll: 0.0, browAngle: 0.0, browDist: 0.0,
                        mouthCurve: -0.8, mouthOpen: 0.3, pupilX: 0.0, tilt: 0.0 },
                duration: 0.3,
                interpolation: 'easeOut'
            },
            'sad': {
                state: { eyeOpen: 0.7, eyeRoll: 0.0, browAngle: 10.0, browDist: 3.0,
                        mouthCurve: 0.8, mouthOpen: 0.1, pupilX: 0.0, tilt: 0.0 },
                duration: 0.4,
                interpolation: 'easeIn'
            },
            'angry': {
                state: { eyeOpen: 0.8, eyeRoll: 0.0, browAngle: -30.0, browDist: -5.0,
                        mouthCurve: 0.2, mouthOpen: 0.05, pupilX: 0.0, tilt: 0.0 },
                duration: 0.2,
                interpolation: 'easeOut'
            },
            'surprised': {
                state: { eyeOpen: 1.2, eyeRoll: 0.0, browAngle: 15.0, browDist: -2.0,
                        mouthCurve: 0.0, mouthOpen: 0.6, pupilX: 0.0, tilt: 0.0 },
                duration: 0.2,
                interpolation: 'easeOut'
            }
        };

        const command = commands[type];
        if (command) {
            const message = {
                timestamp: Date.now() / 1000,
                ...command
            };
            ws.send(JSON.stringify(message));
            console.log('Sent command:', type, message);
        }
    }

    function playScenario(scenarioName) {
        if (!ws || ws.readyState !== WebSocket.OPEN) {
            alert('–°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É!');
            return;
        }

        const scenarios = {
            'greeting': [
                { state: { eyeOpen: 1.0, eyeRoll: 0.0, browAngle: 0.0, browDist: 0.0,
                          mouthCurve: -0.8, mouthOpen: 0.3, pupilX: 0.0, tilt: 0.0 },
                  duration: 0.3, interpolation: 'easeOut' },
                { state: { eyeOpen: 1.0, eyeRoll: 0.0, browAngle: 5.0, browDist: -1.0,
                          mouthCurve: -0.8, mouthOpen: 0.1, pupilX: 0.0, tilt: 5.0 },
                  duration: 0.2, interpolation: 'easeInOut' },
                { state: { eyeOpen: 1.0, eyeRoll: 0.0, browAngle: 0.0, browDist: 0.0,
                          mouthCurve: 0.0, mouthOpen: 0.1, pupilX: 0.0, tilt: 0.0 },
                  duration: 0.3, interpolation: 'easeIn' }
            ],
            'thinking': [
                { state: { eyeOpen: 0.8, eyeRoll: 0.3, browAngle: 5.0, browDist: 2.0,
                          mouthCurve: 0.0, mouthOpen: 0.1, pupilX: 0.2, tilt: -5.0 },
                  duration: 0.4, interpolation: 'easeInOut' },
                { state: { eyeOpen: 0.9, eyeRoll: -0.2, browAngle: 8.0, browDist: 1.0,
                          mouthCurve: 0.1, mouthOpen: 0.05, pupilX: -0.1, tilt: 5.0 },
                  duration: 0.6, interpolation: 'easeInOut' },
                { state: { eyeOpen: 0.8, eyeRoll: 0.0, browAngle: 3.0, browDist: 1.5,
                          mouthCurve: 0.0, mouthOpen: 0.1, pupilX: 0.0, tilt: 0.0 },
                  duration: 0.4, interpolation: 'easeIn' }
            ],
            'laughing': [
                { state: { eyeOpen: 1.0, eyeRoll: 0.0, browAngle: -5.0, browDist: -1.0,
                          mouthCurve: -1.0, mouthOpen: 0.8, pupilX: 0.0, tilt: 0.0 },
                  duration: 0.2, interpolation: 'easeOut' },
                { state: { eyeOpen: 0.7, eyeRoll: 0.1, browAngle: -8.0, browDist: -2.0,
                          mouthCurve: -0.9, mouthOpen: 0.6, pupilX: 0.1, tilt: 2.0 },
                  duration: 0.1, interpolation: 'easeInOut' },
                { state: { eyeOpen: 1.0, eyeRoll: -0.1, browAngle: -5.0, browDist: -1.0,
                          mouthCurve: -1.0, mouthOpen: 0.7, pupilX: -0.1, tilt: -2.0 },
                  duration: 0.1, interpolation: 'easeInOut' },
                { state: { eyeOpen: 0.9, eyeRoll: 0.0, browAngle: -3.0, browDist: 0.0,
                          mouthCurve: -0.5, mouthOpen: 0.2, pupilX: 0.0, tilt: 0.0 },
                  duration: 0.3, interpolation: 'easeIn' }
            ],
            'sleeping': [
                { state: { eyeOpen: 0.3, eyeRoll: 0.0, browAngle: 2.0, browDist: 1.0,
                          mouthCurve: 0.2, mouthOpen: 0.05, pupilX: 0.0, tilt: 0.0 },
                  duration: 0.5, interpolation: 'easeInOut' },
                { state: { eyeOpen: 0.1, eyeRoll: 0.0, browAngle: 1.0, browDist: 0.5,
                          mouthCurve: 0.3, mouthOpen: 0.1, pupilX: 0.0, tilt: 5.0 },
                  duration: 0.8, interpolation: 'easeInOut' },
                { state: { eyeOpen: 0.2, eyeRoll: 0.0, browAngle: 2.0, browDist: 1.0,
                          mouthCurve: 0.2, mouthOpen: 0.05, pupilX: 0.0, tilt: -5.0 },
                  duration: 0.7, interpolation: 'easeInOut' }
            ]
        };

        const scenario = scenarios[scenarioName];
        if (scenario) {
            console.log('Playing scenario:', scenarioName);

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä —Å—Ü–µ–Ω–∞—Ä–∏—è
            scenario.forEach((frame, index) => {
                setTimeout(() => {
                    const message = {
                        timestamp: Date.now() / 1000,
                        ...frame
                    };
                    ws.send(JSON.stringify(message));
                    console.log('Sent frame:', index, message);
                }, index * 1000); // –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∫–∞–¥—Ä–∞–º–∏ 1 —Å–µ–∫—É–Ω–¥–∞
            });
        }
    }

    function updateCustomValue(sliderId) {
        const value = document.getElementById(sliderId).value;
        document.getElementById(sliderId + 'Value').textContent = value;
    }

    function sendCustomCommand() {
        if (!ws || ws.readyState !== WebSocket.OPEN) {
            alert('–°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É!');
            return;
        }

        const state = {
            eyeOpen: parseFloat(document.getElementById('eyeOpen').value),
            eyeRoll: 0.0,
            browAngle: 0.0,
            browDist: 0.0,
            mouthCurve: parseFloat(document.getElementById('mouthCurve').value),
            mouthOpen: parseFloat(document.getElementById('mouthOpen').value),
            pupilX: 0.0,
            tilt: 0.0
        };

        const message = {
            timestamp: Date.now() / 1000,
            state: state,
            duration: 0.3,
            interpolation: 'easeInOut'
        };

        ws.send(JSON.stringify(message));
        console.log('Sent custom command:', message);
    }

    // –ê–≤—Ç–æ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.addEventListener('load', function() {
        // connect(); // –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    });
</script>
</body>
</html>