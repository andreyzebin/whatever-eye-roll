<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="360" height="360" viewBox="0 0 360 360">
  <defs>
    <clipPath id="eyeClipLeft"><ellipse cx="0" cy="0" rx="24" ry="{{ eyeRy }}"/></clipPath>
    <clipPath id="eyeClipRight"><ellipse cx="0" cy="0" rx="24" ry="{{ eyeRy }}"/></clipPath>

    <!-- Маска для скрытия зубов за контуром рта -->
    <mask id="mouthMask">
      <path d="M {{ negW }} 0 Q 0 {{ minTopCy16 }} {{ w }} 0 Q 0 {{ bottomCy }} {{ negW }} 0" fill="white"/>
    </mask>

    <!-- Градиенты -->
    <linearGradient id="faceGradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#FFE4C9" />
      <stop offset="100%" stop-color="#FFD5B5" />
    </linearGradient>

    <linearGradient id="lipGradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#ff6b6b" />
      <stop offset="100%" stop-color="#e55d5d" />
    </linearGradient>

    <linearGradient id="hairGradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#6B4226" />
      <stop offset="100%" stop-color="#8B4513" />
    </linearGradient>

    <linearGradient id="dressGradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#FF69B4" />
      <stop offset="100%" stop-color="#FF1493" />
    </linearGradient>

    <filter id="softShadow" x="-20%" y="-20%" width="140%" height="140%">
      <feGaussianBlur in="SourceAlpha" stdDeviation="2" />
      <feOffset dx="1" dy="1" result="offsetblur"/>
      <feFlood flood-color="rgba(0,0,0,0.2)"/>
      <feComposite in2="offsetblur" operator="in"/>
      <feMerge>
        <feMergeNode/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
  </defs>

  <!-- Задние волосы с таким же наклоном, но позади всего -->
  <g id="backHairGroup" transform="translate(180,180) rotate({{ tilt }})">
    <path d="M -120 -30
             C -140 50, -110 160, 0 190
             C 110 160, 140 50, 120 -30
             C 90 -60, -90 -60, -120 -30 Z"
          fill="url(#hairGradient)"/>
  </g>

  <!-- Тело (без поворота) -->
  <g id="bodyGroup" transform="translate(180,250)">
    <!-- Плечи и бюст -->
    <path d="M -100 50
             C -120 30, -80 0, -60 -20
             C -40 -40, -30 -50, 0 -60
             C 30 -50, 40 -40, 60 -20
             C 80 0, 120 30, 100 50
             Z"
          fill="url(#dressGradient)" stroke="#C71585" stroke-width="2"/>

    <!-- Шея -->
    <path d="M -20 -60 L -15 -80 L 15 -80 L 20 -60 Z" fill="#FFD5B5" stroke="#e6c79a" stroke-width="1.5"/>
  </g>

  <g id="faceGroup" transform="translate(180,180) rotate({{ tilt }})">
    <!-- Круглое лицо -->
    <circle cx="0" cy="0" r="100" fill="url(#faceGradient)" stroke="#e6c79a" stroke-width="1.5"/>

    <!-- Легкий румянец -->
    <ellipse cx="-35" cy="15" rx="20" ry="12" fill="#FFB6C1" opacity="0.3" filter="url(#softShadow)"/>
    <ellipse cx="35" cy="15" rx="20" ry="12" fill="#FFB6C1" opacity="0.3" filter="url(#softShadow)"/>



    <!-- Left eye -->
    <g transform="translate(-40,-10)">
      <ellipse cx="0" cy="0" rx="22" ry="{{ eyeRy }}" fill="#fff" stroke="#e6e6fa" stroke-width="1"/>
      <g clip-path="url(#eyeClipLeft)">
        <ellipse cx="{{ pupilX }}" cy="{{ rollOffset }}" rx="{{ irisR }}" ry="{{ irisR }}" fill="#4a2c5f"/>
        <circle cx="{{ pupilX }}" cy="{{ rollOffset }}" r="3.5" fill="#000"/>
        <!-- Блики в глазах -->
        <ellipse cx="{{ pupilX - 2 }}" cy="{{ rollOffset - 2 }}" rx="1.5" ry="1" fill="#fff" opacity="0.8"/>
      </g>
      <!-- Ресницы -->
      <path d="M -16 -10 L -20 -16" stroke="#2c1a3f" stroke-width="1.5" stroke-linecap="round"/>
      <path d="M -8 -12 L -10 -18" stroke="#2c1a3f" stroke-width="1.5" stroke-linecap="round"/>
      <path d="M 0 -13 L 0 -19" stroke="#2c1a3f" stroke-width="1.5" stroke-linecap="round"/>
      <path d="M 8 -12 L 10 -18" stroke="#2c1a3f" stroke-width="1.5" stroke-linecap="round"/>
      <path d="M 16 -10 L 20 -16" stroke="#2c1a3f" stroke-width="1.5" stroke-linecap="round"/>
    </g>

    <!-- Right eye -->
    <g transform="translate(40,-10)">
      <ellipse cx="0" cy="0" rx="22" ry="{{ eyeRy }}" fill="#fff" stroke="#e6e6fa" stroke-width="1"/>
      <g clip-path="url(#eyeClipRight)">
        <ellipse cx="{{ pupilX }}" cy="{{ rollOffset }}" rx="{{ irisR }}" ry="{{ irisR }}" fill="#4a2c5f"/>
        <circle cx="{{ pupilX }}" cy="{{ rollOffset }}" r="3.5" fill="#000"/>
        <!-- Блики в глазах -->
        <ellipse cx="{{ pupilX - 2 }}" cy="{{ rollOffset - 2 }}" rx="1.5" ry="1" fill="#fff" opacity="0.8"/>
      </g>
      <!-- Ресницы -->
      <path d="M -16 -10 L -20 -16" stroke="#2c1a3f" stroke-width="1.5" stroke-linecap="round"/>
      <path d="M -8 -12 L -10 -18" stroke="#2c1a3f" stroke-width="1.5" stroke-linecap="round"/>
      <path d="M 0 -13 L 0 -19" stroke="#2c1a3f" stroke-width="1.5" stroke-linecap="round"/>
      <path d="M 8 -12 L 10 -18" stroke="#2c1a3f" stroke-width="1.5" stroke-linecap="round"/>
      <path d="M 16 -10 L 20 -16" stroke="#2c1a3f" stroke-width="1.5" stroke-linecap="round"/>
    </g>

    <!-- Eyebrows -->
    <g transform="translate(-40,{{ browY - 5 }}) rotate({{ negBrowAngle }})">
      <path d="M -18 4 Q 0 -6 18 4" stroke="#5b3d2e" stroke-width="3" stroke-linecap="round" fill="none" filter="url(#softShadow)"/>
    </g>
    <g transform="translate(40,{{ browY - 5 }}) rotate({{ browAngle }})">
      <path d="M -18 4 Q 0 -6 18 4" stroke="#5b3d2e" stroke-width="3" stroke-linecap="round" fill="none" filter="url(#softShadow)"/>
    </g>

    <!-- Нос -->
    <path d="M -6 15 Q 0 25 6 15" stroke="#e6c79a" stroke-width="1.5" fill="none" stroke-linecap="round"/>

    <!-- Mouth -->
    <g transform="translate(0,35)">
      <!-- Основной контур рта -->
      <path d="M {{ negW }} 0 Q 0 {{ minTopCy16 }} {{ w }} 0 Q 0 {{ bottomCy }} {{ negW }} 0"
            fill="url(#lipGradient)" opacity="0.9"/>

      <!-- Зубы -->
      <g id="teeth" mask="url(#mouthMask)" opacity="{{ mouthOpen }}">
        {% set toothWidth = w / 4 %}
        {% set toothHeight = 8 %}
        {% set teethY = 2 %}

        {% for i in range(-2, 2) %}
          {% set x = i * toothWidth + toothWidth/2 %}
          <rect x="{{ x - toothWidth/2 }}" y="{{ teethY }}"
                width="{{ toothWidth - 1 }}" height="{{ toothHeight }}"
                fill="#fff" stroke="#eee" stroke-width="0.3" rx="1"/>
        {% endfor %}
      </g>

      <!-- Верхняя линия рта -->
      <path d="M {{ negW }} 0 Q 0 {{ minTopCy16 }} {{ w }} 0"
            stroke="#8b4513" stroke-width="1.5" fill="none" stroke-linecap="round"/>

    </g>

    <!-- Маска для челки с очень крупными разделениями -->
    <mask id="bangsMask">
      <!-- Вся челка по умолчанию видна -->
      <rect x="-200" y="-200" width="400" height="200" fill="white"/>

      <!-- Центральный большой пробор -->
      <path d="M -25 -40
               Q 0 0 25 -40
               Q 0 -30 -25 -40 Z"
            fill="black"/>

      <!-- Левое крупное разделение -->
      <path d="M -80 -40
               Q -60 5 -40 -40
               Q -60 -25 -80 -40 Z"
            fill="black"/>

      <!-- Правое крупное разделение -->
      <path d="M 40 -40
               Q 60 5 80 -40
               Q 60 -25 40 -40 Z"
            fill="black"/>
    </mask>

    <!-- Волосы спереди с широкими прорезями -->
    <path d="M -110 -35
             C -120 -60, -70 -105, 0 -110
             C 70 -105, 120 -60, 110 -35
             C 80 -25, -80 -25, -110 -35 Z"
          fill="url(#hairGradient)" mask="url(#bangsMask)"/>



    </g>

  </g>
</svg>